#include <Wire.h> 
#include <LiquidCrystal_I2C.h>
#include <Adafruit_Sensor.h>
#include <DHT.h>
#include <DHT_U.h>
#define DHTPIN A0
#define DHTTYPE    DHT11     // DHT 11
LiquidCrystal_I2C lcd(0x27,20,4);  // set the LCD address to 0x27 for a 16 chars and 2 line display
DHT_Unified dht(DHTPIN, DHTTYPE);
uint32_t delayMS;
float temprature=0.0;
float ptemprature=0.0;
float humidity=0.0;
float phumidity=0.0;
int water_level=0;
int pwater_level=0;
int fan=3;
int light=4;
int water=5;
int water_pin=A1;
String lineclear="                  ";
float ctemp=0;
float chumidity=0;
int start=0;
void setup() {
  Serial.begin(115200);
  pinMode(fan,OUTPUT);
  pinMode(light,OUTPUT);
  pinMode(water,OUTPUT);
  digitalWrite(fan,1);
  digitalWrite(light,1);
  digitalWrite(water,1);
  pinMode(water_pin,INPUT);
  lcd.init();
  dht.begin();                      // initialize the lcd 
  lcd.backlight();
  lcd.setCursor(0,0);
  lcd.print("Auto_Hydroponic");
  lcd.setCursor(0,1);
  lcd.print("Fodder_Grow_Chamber");
  delay(3000);
  lcd.setCursor(0,0);
  lcd.print(lineclear);
  lcd.setCursor(0,1);
  lcd.print(lineclear);
  lcd.setCursor(0,0);
  lcd.print("Temp:");
  lcd.setCursor(0,1);
  lcd.print("Humi:");
  lcd.setCursor(11,0);
  lcd.print((char)223);
  lcd.setCursor(12,0);
  lcd.print("C");
  lcd.setCursor(11,1);
  lcd.print("%");
  lcd.setCursor(14,1);
  lcd.print("W");
  lcd.setCursor(15,1);
  lcd.print("0");

}
void loop() {
  delay(delayMS);
  sensors_event_t event;
  dht.temperature().getEvent(&event);
  if (isnan(event.temperature)) {
    Serial.println(F("Error reading temperature!"));
  }else {
    temprature=event.temperature;
    if(start==0){
      ctemp=temprature;
    }
    if(ptemprature != temprature){
      lcd.setCursor(5,0);
      lcd.print(temprature);
      Serial.print(F("Temperature: "));
      Serial.print(event.temperature);
      Serial.println(F("Â°C"));
      ptemprature=temprature;
      if(temprature > ctemp+2.0){
        digitalWrite(fan,0);
        digitalWrite(light,1);
      }else if(temprature < ctemp){
        digitalWrite(fan,1);
        digitalWrite(light,0);
      }
    }
  }
  // Get humidity event and print its value.
  dht.humidity().getEvent(&event);
  if (isnan(event.relative_humidity)) {
    Serial.println(F("Error reading humidity!"));
  }else {
    humidity=event.relative_humidity;
    if(start==0){
      chumidity=humidity;
      start++;
    }
    if(phumidity != humidity){
      lcd.setCursor(5,1);
      lcd.print(humidity);
      Serial.print(F("Humidity: "));
      Serial.print(humidity);
      Serial.println(F("%"));
      phumidity=humidity;
      if(humidity > chumidity+2.0){
        //digitalWrite(fan,1);
        //digitalWrite(light,1);
      }else if(humidity < chumidity){
        //digitalWrite(fan,0);
        //digitalWrite(light,0);
      }
    }
  }
  water_level=digitalRead(water_pin);
  if(water_level != pwater_level){
     Serial.println(water_level);
    if(water_level == 0 ){
        lcd.print("1");
        if(digitalRead('water')==LOW){ //Tank full and motor work
          digitalWrite(water,1);
        }
    }else{
        lcd.print("1");
        if(digitalRead('water')==HIGH){ //Tank full and motor work
          digitalWrite(water,0);
        }
    }
    pwater_level=water_level;
  }
}
}
